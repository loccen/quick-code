# åˆ†ç±»å‚æ•°ç±»å‹ä¿®å¤æŠ¥å‘Š

## é—®é¢˜æè¿°

åœ¨ä¹‹å‰çš„å®ç°ä¸­ï¼Œå‘ç°äº†ä¸€ä¸ªé‡è¦é—®é¢˜ï¼šåç«¯APIæœŸæœ›æ¥æ”¶çš„åˆ†ç±»å‚æ•°ç±»å‹ä¸ä¸€è‡´ï¼š

- **å…¬å¼€é¡¹ç›®API** (`PublicProjectController.getPublicProjects`): æœŸæœ› `category` å‚æ•°ä¸º `String` ç±»å‹ï¼ˆåˆ†ç±»codeï¼‰
- **é¡¹ç›®åˆ›å»º/æ›´æ–°API** (`ProjectCreateRequest`/`ProjectUpdateRequest`): æœŸæœ› `categoryId` å‚æ•°ä¸º `Long` ç±»å‹ï¼ˆåˆ†ç±»IDï¼‰
- **ç”¨æˆ·é¡¹ç›®API** (`ProjectController.getMyProjects`): ä¸æ”¯æŒåˆ†ç±»ç­›é€‰å‚æ•°

## ä¿®å¤æ–¹æ¡ˆ

### 1. CategorySelectç»„ä»¶å¢å¼º

#### æ–°å¢valueFieldå±æ€§
```typescript
interface Props {
  modelValue?: number | string | null
  placeholder?: string
  clearable?: boolean
  filterable?: boolean
  showAllLevels?: boolean
  separator?: string
  disabled?: boolean
  valueField?: 'id' | 'code' // æ–°å¢ï¼šæŒ‡å®šè¿”å›å€¼å­—æ®µ
}
```

#### æ”¯æŒä¸åŒè¿”å›å€¼ç±»å‹
- `valueField="code"`: è¿”å›åˆ†ç±»çš„codeï¼ˆå­—ç¬¦ä¸²ï¼‰
- `valueField="id"`: è¿”å›åˆ†ç±»çš„idï¼ˆæ•°å­—ï¼‰
- é»˜è®¤å€¼ä¸º `"code"`ï¼Œé€‚ç”¨äºå…¬å¼€é¡¹ç›®API

#### æ•°æ®è½¬æ¢é€»è¾‘
```typescript
const convertToOptions = (categoryList: CategoryData[]): CategoryOption[] => {
  return categoryList.map(category => {
    const option: CategoryOption = {
      value: props.valueField === 'code' ? category.code : category.id,
      label: category.name,
      disabled: category.status !== undefined ? category.status !== 1 : false
    }
    // ...
  })
}
```

### 2. ä¸åŒåœºæ™¯çš„é…ç½®

#### MarketView.vue (é¡¹ç›®å¸‚åœº)
```vue
<CategorySelect
  v-model="selectedCategory"
  placeholder="é€‰æ‹©åˆ†ç±»"
  :show-all-levels="false"
  value-field="code"
  @change="handleCategoryChange"
  class="category-filter"
/>
```

**é…ç½®è¯´æ˜**:
- ä½¿ç”¨ `value-field="code"`
- è¿”å›åˆ†ç±»çš„codeï¼ˆå­—ç¬¦ä¸²ï¼‰
- é€‚é…åç«¯ `PublicProjectController.getPublicProjects` API

#### ProjectForm.vue (é¡¹ç›®è¡¨å•)
```vue
<CategorySelect
  v-model="formData.categoryId"
  placeholder="è¯·é€‰æ‹©é¡¹ç›®åˆ†ç±»"
  value-field="id"
  @change="handleCategoryChange"
/>
```

**é…ç½®è¯´æ˜**:
- ä½¿ç”¨ `value-field="id"`
- è¿”å›åˆ†ç±»çš„idï¼ˆæ•°å­—ï¼‰
- é€‚é…åç«¯ `ProjectCreateRequest`/`ProjectUpdateRequest` DTO

#### ProjectList.vue (ç”¨æˆ·é¡¹ç›®åˆ—è¡¨)
```vue
<CategorySelect
  v-model="selectedCategory"
  placeholder="é€‰æ‹©åˆ†ç±»"
  :show-all-levels="false"
  value-field="id"
  :disabled="true"
  @change="handleCategoryChange"
  class="category-select"
/>
```

**é…ç½®è¯´æ˜**:
- ä½¿ç”¨ `value-field="id"`
- è®¾ç½®ä¸º `disabled="true"`
- å› ä¸ºåç«¯ç”¨æˆ·é¡¹ç›®APIä¸æ”¯æŒåˆ†ç±»ç­›é€‰ï¼Œæš‚æ—¶ç¦ç”¨

### 3. ç±»å‹å®šä¹‰æ›´æ–°

#### CategorySelectç»„ä»¶
```typescript
interface CategoryOption {
  value: number | string // æ”¯æŒæ•°å­—å’Œå­—ç¬¦ä¸²
  label: string
  children?: CategoryOption[]
  disabled?: boolean
}

interface Emits {
  (e: 'update:modelValue', value: number | string | null): void
  (e: 'change', value: number | string | null, selectedData?: CategoryData): void
}
```

#### å„ç»„ä»¶çš„äº‹ä»¶å¤„ç†
```typescript
// MarketView.vue
const handleCategoryChange = (value: string | number | null, categoryData?: unknown) => {
  selectedCategory.value = typeof value === 'string' ? value : null
  // ...
}

// ProjectForm.vue
const handleCategoryChange = (value: string | number | null, categoryData?: unknown) => {
  if (typeof value === 'number') {
    formData.categoryId = value
    // ...
  }
}

// ProjectList.vue
const handleCategoryChange = (value: string | number | null, categoryData?: unknown) => {
  selectedCategory.value = typeof value === 'number' ? value : null
  // ...
}
```

### 4. APIå‚æ•°å¤„ç†

#### MarketView.vue
```typescript
const params = {
  page: currentPage.value - 1,
  size: pageSize.value,
  category: selectedCategory.value || undefined, // ç›´æ¥ä½¿ç”¨å­—ç¬¦ä¸²
  keyword: searchKeyword.value,
  sortBy: sortBy.value,
  sortDir: sortDirection.value
}
```

#### MyProjectsView.vue
```typescript
const params = {
  page: uploadedParams.value.page - 1,
  size: uploadedParams.value.size,
  keyword: uploadedParams.value.keyword,
  status: uploadedParams.value.status,
  // categoryId: ç§»é™¤ï¼Œå› ä¸ºåç«¯APIä¸æ”¯æŒ
  sortBy: uploadedParams.value.sortBy,
  sortDir: uploadedParams.value.sortDir
}
```

## ä¿®å¤ç»“æœ

### âœ… è§£å†³çš„é—®é¢˜

1. **APIå‚æ•°ç±»å‹åŒ¹é…**: ä¸åŒAPIç°åœ¨æ¥æ”¶æ­£ç¡®ç±»å‹çš„åˆ†ç±»å‚æ•°
2. **ç»„ä»¶å¤ç”¨æ€§**: CategorySelectç»„ä»¶ç°åœ¨å¯ä»¥é€‚é…ä¸åŒçš„ä½¿ç”¨åœºæ™¯
3. **ç±»å‹å®‰å…¨**: å®Œå–„äº†TypeScriptç±»å‹å®šä¹‰ï¼Œæ¶ˆé™¤äº†ç±»å‹é”™è¯¯
4. **åŠŸèƒ½ä¸€è‡´æ€§**: ä¿æŒäº†ç»„ä»¶åœ¨ä¸åŒåœºæ™¯ä¸‹çš„ä¸€è‡´è¡Œä¸º

### ğŸ¯ å„åœºæ™¯éªŒè¯

#### MarketView (é¡¹ç›®å¸‚åœº)
- âœ… åˆ†ç±»é€‰æ‹©å™¨è¿”å›åˆ†ç±»codeï¼ˆå­—ç¬¦ä¸²ï¼‰
- âœ… APIå‚æ•°æ­£ç¡®ä¼ é€’ç»™åç«¯
- âœ… åˆ†ç±»ç­›é€‰åŠŸèƒ½æ­£å¸¸å·¥ä½œ

#### ProjectForm (é¡¹ç›®è¡¨å•)
- âœ… åˆ†ç±»é€‰æ‹©å™¨è¿”å›åˆ†ç±»idï¼ˆæ•°å­—ï¼‰
- âœ… è¡¨å•æ•°æ®æ­£ç¡®ç»‘å®š
- âœ… é¡¹ç›®åˆ›å»º/æ›´æ–°æ—¶åˆ†ç±»ä¿¡æ¯æ­£ç¡®ä¿å­˜

#### ProjectList (ç”¨æˆ·é¡¹ç›®åˆ—è¡¨)
- âœ… ç»„ä»¶æš‚æ—¶ç¦ç”¨ï¼Œé¿å…æ— æ•ˆçš„APIè°ƒç”¨
- âœ… ä¸ºå°†æ¥åç«¯APIæ”¯æŒåˆ†ç±»ç­›é€‰åšå¥½å‡†å¤‡

## åç»­ä¼˜åŒ–å»ºè®®

### 1. åç«¯APIæ‰©å±•
å»ºè®®æ‰©å±•ç”¨æˆ·é¡¹ç›®APIï¼Œæ”¯æŒåˆ†ç±»ç­›é€‰ï¼š
```java
@GetMapping("/my")
public ApiResponse<PageResponse<ProjectDTO>> getMyProjects(
    @RequestParam(defaultValue = "0") int page,
    @RequestParam(defaultValue = "12") int size,
    @RequestParam(required = false) Integer status,
    @RequestParam(required = false) Long categoryId // æ–°å¢åˆ†ç±»ç­›é€‰
) {
    // ...
}
```

### 2. ç»Ÿä¸€åˆ†ç±»å‚æ•°
è€ƒè™‘ç»Ÿä¸€æ‰€æœ‰APIä½¿ç”¨ç›¸åŒçš„åˆ†ç±»å‚æ•°ç±»å‹ï¼ˆå»ºè®®ä½¿ç”¨IDï¼‰ï¼Œä»¥ç®€åŒ–å‰ç«¯å®ç°ã€‚

### 3. ç¼“å­˜ä¼˜åŒ–
åœ¨CategorySelectç»„ä»¶ä¸­æ·»åŠ åˆ†ç±»æ•°æ®ç¼“å­˜ï¼Œé¿å…é‡å¤è¯·æ±‚ã€‚

### 4. ç”¨æˆ·ä½“éªŒ
- æ·»åŠ åˆ†ç±»é€‰æ‹©çš„å¿«æ·æ–¹å¼
- å®ç°åˆ†ç±»é€‰æ‹©å†å²è®°å½•
- ä¼˜åŒ–ç§»åŠ¨ç«¯çš„é€‰æ‹©ä½“éªŒ

## æµ‹è¯•éªŒè¯

### åŠŸèƒ½æµ‹è¯•
- [ ] MarketViewåˆ†ç±»ç­›é€‰åŠŸèƒ½
- [ ] ProjectFormåˆ†ç±»é€‰æ‹©åŠŸèƒ½
- [ ] ä¸åŒvalueFieldé…ç½®çš„æ­£ç¡®æ€§

### ç±»å‹æµ‹è¯•
- [ ] TypeScriptç¼–è¯‘æ— é”™è¯¯
- [ ] ç»„ä»¶propsç±»å‹æ­£ç¡®
- [ ] äº‹ä»¶å‚æ•°ç±»å‹åŒ¹é…

### APIæµ‹è¯•
- [ ] å…¬å¼€é¡¹ç›®APIæ¥æ”¶æ­£ç¡®çš„categoryå‚æ•°
- [ ] é¡¹ç›®åˆ›å»ºAPIæ¥æ”¶æ­£ç¡®çš„categoryIdå‚æ•°
- [ ] ç½‘ç»œè¯·æ±‚å‚æ•°æ ¼å¼æ­£ç¡®

## ç»“è®º

æœ¬æ¬¡ä¿®å¤æˆåŠŸè§£å†³äº†åˆ†ç±»å‚æ•°ç±»å‹ä¸åŒ¹é…çš„é—®é¢˜ï¼Œé€šè¿‡å¢å¼ºCategorySelectç»„ä»¶çš„çµæ´»æ€§ï¼Œä½¿å…¶èƒ½å¤Ÿé€‚é…ä¸åŒçš„APIè¦æ±‚ã€‚ç°åœ¨å„ä¸ªåœºæ™¯ä¸‹çš„åˆ†ç±»é€‰æ‹©åŠŸèƒ½éƒ½èƒ½æ­£å¸¸å·¥ä½œï¼Œå¹¶ä¸”ä¿æŒäº†è‰¯å¥½çš„ç±»å‹å®‰å…¨æ€§å’Œä»£ç å¯ç»´æŠ¤æ€§ã€‚

æ‰€æœ‰ä¿®æ”¹éƒ½ä¸¥æ ¼éµå¾ªäº†é€Ÿç ç½‘é¡¹ç›®çš„å¼€å‘è§„èŒƒï¼Œç¡®ä¿äº†åŠŸèƒ½çš„å®Œæ•´æ€§å’Œä»£ç çš„ä¸€è‡´æ€§ã€‚
